# Use the official PyTorch image with CUDA 11 and cuDNN8 pre-installed
FROM pytorch/pytorch:latest

# Set the working directory
WORKDIR /app

# Clone the DETR repository
RUN git clone https://github.com/facebookresearch/detr.git /app/detr

# Set the working directory to the cloned repository
WORKDIR /app/detr

# Install PyTorch and torchvision
RUN conda install -y -c pytorch pytorch torchvision

# Install additional required packages
RUN conda install -y cython scipy \
    && pip install -U 'git+https://github.com/cocodataset/cocoapi.git#subdirectory=PythonAPI'

# Optional: Install panopticapi if needed
RUN pip install git+https://github.com/cocodataset/panopticapi.git

# Set the entrypoint for the container
ENTRYPOINT ["python", "main.py"]

# Allow users to pass additional arguments to the entrypoint script
CMD ["--batch_size", "2", "--no_aux_loss", "--eval", "--resume", "https://dl.fbaipublicfiles.com/detr/detr-r50-e632da11.pth", "--coco_path", "/path/to/coco"]

# Expose any necessary ports (if applicable, not mentioned in instructions)
# EXPOSE <port_number>